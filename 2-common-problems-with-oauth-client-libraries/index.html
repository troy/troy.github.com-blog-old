
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="author" content="Troy Davis">
  <meta name="description" content="Troy Davis, Seattle">

  
    <title>2 common problems with OAuth client libraries - Troy Davis</title>
  


  
  <meta name="description" content="I posted a long explanation to the fusion-tables-users group about using third-party libraries with Fusion Tables over OAuth. It might also help &hellip;">
  



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://troy.github.com/2-common-problems-with-oauth-client-libraries">
  <link href="/favicon.ico" rel="icon">
  <script type="text/javascript" src="http://use.typekit.com/zcp2xbp.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/troydavis" rel="alternate" title="Troy Davis, Seattle" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7603079-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body   >

	<div class="container">

		<div class="four columns">
  			<nav role="navigation"><ul class="title">
  <li><a href="/">Troy Davis</a></li>
</ul>
  
<ul class="main-navigation">

  <li class="other"><a href="/">Blog</a></li>
  <li class="other"><a href="http://twitter.com/troyd">@troyd</a></li>
  <li class="other"><a href="https://papertrailapp.com/">Papertrail</a></li>
</ul>


<ul class="subscription" data-subscription="rss">
  <li class="other"><a href="http://feeds.feedburner.com/troydavis" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:troy.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  



</nav>
        <aside class="sidebar">
          
            <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/why-web-apps-suck-at-invoices-and-vice-versa/">Why Web apps suck at invoices (and vice versa)</a>
      </li>
    
      <li class="post">
        <a href="/borrower-privacy-in-peer-to-peer-lending/">Examining borrower privacy in peer-to-peer lending</a>
      </li>
    
      <li class="post">
        <a href="/a-few-days-with-the-slimfold-tyvek-wallet/">A few days with the SlimFold Tyvek Wallet</a>
      </li>
    
      <li class="post">
        <a href="/cost-analysis-of-king-county-bike-share-busin/">Cost analysis of King County Bike Share Business Plan</a>
      </li>
    
      <li class="post">
        <a href="/making-2-factor-authentication-viral/">Making 2-factor authentication grow faster than linear</a>
      </li>
    
  </ul>
</section>


<section id="twitter">
  <h1 class="tweets">Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("troyd", 3, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/troyd" class="twitter-follow-button" data-show-count="false">Follow @troyd</a>
  
</section>





          

          <section id="code">
            <h2>Code</h2>
              <p><a target="_blank" href="https://github.com/ryandeussing" target="_blank">GitHub</a></p>         
          </section>

          <section id="habit">
            <h2>Habit</h2>
              <p><a target="_blank" href="http://joesgoals.com">Daily goals</a></p>
              <a target="_blank" href="http://joesgoals.com"><div id="goals"></div></a>  
          </section>


        </aside>    
  	</div>
    
    

    <header class="twelve columns" role="banner">
    
<hgroup>
  <h1>Troy Davis, Seattle</h1>
</hgroup>

    </header>

    

  	<div id="main" class="twelve columns">
	    <div id="content">
	      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">2 Common Problems With OAuth Client Libraries</h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


    
      <div class="sharing">
  
  
  
</div>

    


<div class="entry-content"><p>I posted a long <a href="http://groups.google.com/group/fusion-tables-users-group/msg/535854503fa21868">explanation</a> to the fusion-tables-users group about using third-party libraries with Fusion Tables over OAuth. It might also help folks debugging OAuth problems or adding OAuth support to existing libraries. Full text below.</p>
<p><!--more--><span style="">Just an update for the archives and anyone else debugging this. I went through the <a href="http://code.google.com/p/fusion-tables-client-python/source/browse/trunk/src/samples/oauth_example.py?r=16">Python example</a> </span><span style="">and it does work for POST requests in the body. I tested CREATE and INSERT.</span></p>
<p><span style="">Here are the 2 things that were tripping up the Ruby GData library coupled with someone&#8217;s monkeypatched OAuth auth_handler (GData::Auth::OAuth). They basically boil down to not being designed for, or frequently used with, POST requests. From skimming other libraries, these problems are endemic to lesser-used OAuth libraries.</span></p>
<p><span style="">Here goes:</span></p>
<p><span style="">1. The GData::Auth::OAuth only pulled out GET params from the URL, not POST params in the request body. POST params need to be sorted alongside the OAuth parameters when creating the signature base, so this immediately made my signatures invalid.</span></p>
<p><span style="">I saw a couple causes for this in other libraries:</span></p>
<ul>
<li>designing for GET and then exposing a convenience POST method as&nbsp;<span style="">an afterthought (without looking at the body params)</span></li>
<li><span style="">one person wrote the HTTP client, another wrote the OAuth signer, </span><span style="">and a third wrote the Fusion Tables library or GData extension, and a </span><span style="">corner case got missed (or callers can sign requests before a body is </span><span style="">even defined)</span></li>
</ul>
<p><span style="">2. Most language built-in URI encoders are designed for <a href="http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.1">x-www-form-urlencoded</a>, with spaces as plus characters. OAuth wants</span> <span style="">everything UTF-8, ie U+0020 or %20 for space. The confusing part for Fusion Tables is that this works in GET requests: <a href="https://www.google.com/fusiontables/api/query?sql=select+*+from+317391+limit+1">select+*+from+317391+limit+1</a></span></p>
<p><span style=""><a href="https://www.google.com/fusiontables/api/query?sql=select+*+from+317391+limit+1"></a></span><span style="">.. but that space encoding won&#8217;t work in OAuth signature hashes (and thus not the request body itself), and will show up as 401 Unauthorized rather than an app error. If you&#8217;re adapting an existing Fusion Tables library to work with OAuth, this is something to consider.</span></p>
<p><span style="">Finally, if it helps anyone, here&#8217;s a signature base string for a CREATE statement (private values replaced), for the table schema in the Python example code:</span></p>
<p><span style=""><span style="font-family: arial, sans-serif; font-size: 12px;">POST&amp;http%3A%2F%2F<a href="http://www.google.com/url?sa=D&amp;q=www.google.com%252Ffusiontables%252Fapi" rel="nofollow" target="_blank" style="color: #0000cc;">www.google.com%2Ffusiontables%2Fapi</a>&nbsp;<br />%2Fquery&amp;oauth_consumer_key%3Ddomain.com%26oauth_nonce&nbsp;<br />%3D75556368%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp&nbsp;<br />%3D1305155510%26oauth_token&nbsp;<br />%3D1%252F98y2rqyfdfhuaiheworh327rahyADYSAIYuioydadio%26oauth_version&nbsp;<br />%3D1.0%26sql%3DCREATE%2520TABLE%2520%2527data.csv&nbsp;<br />%2527%2520%2528%2527col2%2527%253A%2520STRING%252C%2527col3%2527%253A&nbsp;<br />%2520STRING%252C%2527col1%2527%253A%2520STRING%2529</span></span></p>
<p><span style="">that signature string is for the param:</span></p>
<p><span style="font-family: arial, sans-serif; font-size: 12px;">sql=CREATE+TABLE+%27data.csv%27+%28%27col2%27%3A+STRING%2C%27col3%27%3A&nbsp;<br />+STRING%2C%27col1%27%3A+STRING%29</span></p>
<p><span style="">I&#8217;ve tested OAuth POST requests sent as the HTTP Authorization header as well as in the body of the POST, and both work.</span></p></div>


  <footer>
    <p class="meta">
      
        <a class="basic-alignment left" href="/this-is-a-test/" title="Previous Post: This is post">&laquo; Previous post</a>
      
      
        <a class="basic-alignment right" href="/zipcar-prize-user-sourced-car-sharing-assignm/" title="next Post: Zipcar Prize proposal: user-sourced car sharing planning algorithm">Next post &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

	    </div>
  	</div>
  
  <footer role="contentinfo"  class="sixteen columns"><center>
<p class="credit">
  <span class="credit">Powered by <a href="http://github.com">GitHub</a>, <a href="https://github.com/imathis/octopress">Octopress</a>, &amp; <a href="https://github.com/dhgamache/Skeleton">Skeleton</a></span>.
</p>
</center>
</footer>
  
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






<script>
  jQuery.noConflict()('li.other').hover (
    function () {
    jQuery.noConflict()(this).toggleClass("current-menu-item")
  });
</script>

</body>
</html>


	</div> <!-- container -->
