
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="author" content="Troy Davis">
  <meta name="description" content="Inputs & Outputs">

  <title>Anatomy of a malware ad on NYTimes.com - Troy Davis, Seattle</title>

  
  <meta name="description" content="On Saturday evening, Avast displayed a malware warning as I loaded a nytimes.com article. After some digging, here&rsquo;s the malware I found. Ad &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://troy.yort.com/anatomy-of-a-malware-ad-on-nytimes-com">
  <link href="/favicon.png" rel="icon">
  <script type="text/javascript" src="http://use.typekit.com/zcp2xbp.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/troydavis" rel="alternate" title="Inputs & Outputs" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7603079-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body   >

	<div class="container">

		<div class="four columns">
  			<nav role="navigation"><ul class="title">
  <li><a href="/">Troy Davis</a></li>
</ul>
  
<ul class="main-navigation">
  <li class="other"><a href="/">Blog</a></li>
  <li class="other"><a href="http://twitter.com/troyd">@troyd</a></li>
  <li class="other"><a href="https://papertrailapp.com/">Papertrail</a></li>
  <li class="other"><a href="http://tacoapp.com/">Taco</a></li>
</ul>


<ul class="subscription" data-subscription="rss">
  <li class="other"><a href="http://feeds.feedburner.com/troydavis" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:troy.yort.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  


</nav>
        <aside class="sidebar">
          
            <a href="https://twitter.com/troyd" class="twitter-follow-button" data-show-count="false">Follow @troyd</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<section>
  <h2>Highlights</h2>
  <ul id="recent_posts">
    <li class="post">
      <a href="/questions-to-ask-before-joining-a-startup/">Questions to ask before joining a startup</a>
    </li>

    <li class="post">
      <a href="/papertrail-joins-solarwinds-and-accelerates-growth/">Papertrail joins SolarWinds and accelerates growth</a>
    </li>

    <li class="post">
      <a href="/the-elements-of-a-great-customer-support-reply/">The elements of a great customer support reply</a>
    </li>
  </ul>
</section>

          

          <section id="habit">
  <h2>Other</h2>

  <p><a target="_blank" href="http://sawsafely.org/">SawSafely.org</a></p>
  <p><a target="_blank" href="http://twitter.com/PedalOften">@PedalOften</a></p>
  <p><a target="_blank" href="http://seattleix.com/">Seattle IX</a></p>
  <p><a target="_blank" href="https://github.com/troy" target="_blank">GitHub</a></p>
</section>

        </aside>    
  	</div>

    

  	<div id="main" class="twelve columns">
	    <div id="content">
	      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Anatomy of a Malware Ad on NYTimes.com</h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


    
      <div class="sharing">
  
  
  
</div>

    


<div class="entry-content"><p>On Saturday evening, Avast displayed a malware warning as I loaded a nytimes.com article. After some digging, here&rsquo;s the malware I found.</p>

<h3>Ad Delivery</h3>

<p>nytimes.com article pages include an ad placement with the HTML DOM ID <code>adxBigAd</code>. From loading a few articles, they seem to rotate between a banner and an iframe. On this article, a 300x250 iframe was inlining this URL: <code>tradenton.com</code> slash <code>?id=21610438</code> (note: I don&rsquo;t recommend visiting it, and URLs are not linked where possible).</p>

<p>A comment gave the campaign ID as <code>Vonage01_1163613_nyt12</code>, though it was obviously unrelated to Vonage. tradenton.com was registered Sept. 2, 2009, so it may have had a previous owner.</p>

<h3>Injection</h3>

<p>tradenton.com serves a 15-line HTML snipped containing this JavaScript:</p>

<script src="http://gist.github.com/186462.js"></script>


<p>As anyone who has looked at phishing links knows, this is nasty on a couple levels. It&rsquo;s <code>eval()</code>&lsquo;ing escaped code, which is almost never needed to serve an ad. Note that the variable <code>action_URL</code> is defined but never used. After unescaping the code, this is what&rsquo;s being run:</p>

<script src="http://gist.github.com/186464.js"></script>


<p>What&rsquo;s served by <code>harlingens.com</code> slash <code>includes02.js</code>? Aha! The eval&#8217;ed JavaScript is requesting a second Javascript, which hits <code>action_URL</code>:</p>

<script src="http://gist.github.com/186466.js"></script>


<h3>Malware</h3>

<p>Now we&rsquo;re talking. Requesting that <code>action_UR</code> on <code>sex-and-the-city.cn</code> actually serves a HTTP 302 Redirect to <code>protection-check07.com</code> slash <code>1/?sess=%3DGQx3jzwMi02MyZpcD0yMDguNzUuNTcuMTIxJnRpbWU9MTI1NjgwMI0MaQ%3DN</code>. And we hit pay dirt. It&rsquo;s a fake page for a non-existent antivirus app, which is actually malware. Titled &ldquo;My computer Online Scan&rdquo;, this page displays this JS alert:</p>

<p><img src="http://images.yort.com/blog/nytimes-malware-1.jpg" alt="Popup from malware advertised on nytimes.com" /></p>

<p>Then resizes the browser window into a full-screen application-style, as if it had become a virus scanner. Some highlights from the static content and JS on this page:</p>

<pre><code>Dont close this window, if your want you PC to be protected.
353 trojans
You need to remove this threat as soon as possible!
Scan procedures finished.
431 Probably harmfull items was found!
</code></pre>

<p>Here&rsquo;s a screen shot:</p>

<p><img src="http://images.yort.com/blog/nytimes-malware-2.jpg" alt="screenshot of web page of malware advertised on nytimes.com" /></p>

<p>Here&rsquo;s <a href="http://gist.github.com/186467">full HTML source</a> in a gist viewer. As usual, these phishers haven&rsquo;t sprung for spelling or grammar checkers.</p>

<p>The page also uses IP-based geocoding by inlining its own iframe called <code>geoip.php</code>, which has city-level granularity (though it was off by 1,000 miles for me). The &ldquo;Full System Cleanup&rdquo; link goes to <code>/download.php?id=2006-63</code> on the same server, which serves a file called <code>Scanner-b4ba2_2006-63.exe</code>.</p>

<p>That redirects to <code>/download/Scanner-b4ba2_2006-63.exe</code>, a static file with the checksum <code>6c5b5669151337ca51ec45b1f5785d02</code>. Running strings on this 167 KB program &ndash; too small for any virus scanner &ndash; has it requesting administrator privileges, though I haven&rsquo;t done detailed forensics.</p>

<h3>Notes</h3>

<p>As of Sept. 12, 2009, <code>tradenton.com</code> and <code>harlingens.com</code> resolved to 212.117.166.69. <code>sex-and-the-city.cn</code> resolved to 94.102.48.29. <code>protection-check07.com</code> had 3 A records: 91.212.107.5, 94.102.51.26, 88.198.107.25. Also, I changed indentation and spacing for readability, so checksums on gist may not match source files.</p>
</div>


  <footer>
    <p class="meta">
      
        <a class="basic-alignment left" href="/unique-conference-venues-in-seattle/" title="Previous Post: Unique conference venues in Seattle">&laquo; Previous post</a>
      
      
        <a class="basic-alignment right" href="/auction-lifecycle-for-data-geeks/" title="next Post: Auction lifecycle for data geeks">Next post &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

	    </div>
  	</div>
  
  <footer role="contentinfo"  class="sixteen columns"><center>
<p class="credit">
  <span class="credit">Powered by <a href="http://github.com">GitHub</a>, <a href="https://github.com/imathis/octopress">Octopress</a>, <a href="https://github.com/ryandeussing/octopress-minimalist">minimalist</a></span>.
</p>
</center>
</footer>
  
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






<script>
  jQuery.noConflict()('li.other').hover (
    function () {
    jQuery.noConflict()(this).toggleClass("current-menu-item")
  });
</script>

</body>
</html>


	</div> <!-- container -->
